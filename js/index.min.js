var nowPicShareIndex = -1, nowHelpIndex = -1, picShareItemStr = "", commentItemStr = "", forumArticleItemStr, helpItemStr = "", picShareList, pageHistory = [], reloadPicShare = !1, uid = "", isLoadingPicShare = !1, isLoadingHelp = !1, isLoadingForum = [!1, !1, !1, !1], userIconCache = {}, userNameCache = {}, app = new Framework7({
    root: "#app", name: "Meowmeow", id: "com.uni.meowmeow", theme: "md", panel: { swipe: "left" }, routes: [{ name: "home", path: "/", url: "./index.html" }, { name: "pic-share-content", path: "/pic-share-content/", url: "./pages/pic-share-content.html" },
    { name: "new-pic-share-post", path: "/new-pic-share-post/", url: "./pages/new-pic-share-post.html" }, { name: "forum-article-content", path: "/forum-article-content/", url: "./pages/forum-article-content.html" }, { name: "new-forum-article", path: "/new-forum-article/", url: "./pages/new-forum-article-post.html" }, { name: "new-help-map-mark", path: "/new-help-map-mark/", url: "./pages/new-help-map-mark.html" }, { name: "new-help", path: "/new-help/", url: "./pages/new-help-post.html" }, { name: "help-content", path: "/help-content/", url: "./pages/help-article-content.html" },
    { name: "fundraising-content", path: "/fundraising-content/", url: "./pages/fundraising-content.html" }, { name: "fundraising-update-content", path: "/fundraising-update-content/", url: "./pages/fundraising-update-content.html" }, { name: "donate-payment-content", path: "/donate-payment-content/", url: "./pages/donate-payment-content.html" }, { name: "select-payment", path: "/select-payment/", url: "./pages/select-payment.html" }, { name: "chatroom-content", path: "/chatroom-content/", url: "./pages/chatroom-content.html" }, {
        name: "noob-tutorial-content",
        path: "/noob-tutorial-content/", url: "./pages/noob-tutorial-content.html"
    }, { name: "donate-records", path: "/donate-records/", url: "./pages/donate-records.html" }], lazy: { threshold: 50, sequential: !1 }
}), $$ = Dom7, nowPageName, loginScreen, signUpScreen;
app.on("tabShow", function (a, d) {
    console.log(a.id); "forum-tab" == a.id ? ReloadAllForumList() : "pic-share-tab" == a.id ? loadPicSharePage(-1, !0) : "help-tab" == a.id ? (console.log("start load help"), console.log(isLoadingHelp), loadHelpPage(-1, !0)) : "fundraising-tab" == a.id ? (console.log("show fundraising"), loadFundraisingPage(-1, !0)) : "chatroom-tab" == a.id ? (console.log("show chatroom"), loadChatroomPage(-1)) : "noob-tab" == a.id ? (console.log("show chatroom"), loadNoobPage(), app.device.android || LoadHospitalPage("", 0, !1, !0)) :
        "my-post-tab" == a.id && (console.log("show my post"), loadMyPost()); "tab-hospital" == a.id ? document.querySelector(".hospital-filter-icon").style.display = "block" : document.querySelector(".hospital-filter-icon").style.display = "none"
});
document.addEventListener("deviceready", function () {
    console.log("device ready"); pageHistory = []; pageHistory.push("/"); document.addEventListener("pause", onPause, !1); document.addEventListener("resume", onResume, !1); document.addEventListener("backbutton", onBackKeyDown, !1); LoginWithLocalStorage(); console.log(auth); signUpScreen = app.loginScreen.create({ el: document.querySelector("#signup-screen"), animate: !0 }); loginScreen = app.loginScreen.create({ el: document.querySelector("#login-screen"), animate: !0 }); !isLogin() &&
        waitForLoginScreen && null == window.localStorage.getItem("userEmail") && loginScreen.open(!0)
}, !1); var isOpeningExitConfirm = !1; function onBackKeyDown() { 1 < app.views.current.router.history.length ? app.views.current.router.back() : isOpeningExitConfirm || (isOpeningExitConfirm = !0, app.dialog.confirm("\u78ba\u5b9a\u8981\u96e2\u958bMeowMeow\u55ce\uff1f", function () { navigator.app.exitApp() }, function () { isOpeningExitConfirm = !1 })) } function onPause() { console.log("pause"); isFirstInitialHelpListener = !0 }
function onResume() {
    console.log("resume"); database.ref("Help").on("value", function (a) {
        a = a.val(); if (isFirstInitialHelpListener) { for (i in a) helpArticleNameCache.push(i); isFirstInitialHelpListener = !1 } else for (i in a) if (!helpArticleNameCache.includes(i) && (helpArticleNameCache.push(i), void 0 != positionCache.lat && a[i].poster != userInfo.uid)) {
            var d = calcCrow(a[i].position.lat, a[i].position.lng, positionCache.lat, positionCache.lng); .5 >= d && (d = (100 * d).toFixed(0), console.log("\u6709\u65b0\u6587\u7ae0"), app.notification.create({
                closeTimeout: 3E3,
                icon: '<img src="img/app_icon.png" style="width:13px;height:13px;"></img>', title: "MeowMeow", titleRightText: "now", subtitle: "\u6709\u8c93\u8c93\u53d7\u50b7\u4e86\uff01", text: "\u5728\u7d04" + d + "\u516c\u5c3a\u8655\u6709\u88ab\u767c\u73fe\u7684\u53d7\u50b7\u8c93\u8c93\uff0c\u53bb\u770b\u770b\u5427\uff01", closeOnClick: !0, on: { click: function () { app.views.current.router.navigate("/help-content/?index=" + i) } }
            }).open())
        }
    })
}
function handle_back() { pageHistory.pop(); console.log(pageHistory); app.views.current.router.back(); "/" == pageHistory[pageHistory.length - 1] && reloadPicShare && (console.log("reload"), loadPicSharePage(-1, !0), reloadPicShare = !1) }
$$(document).on("page:init", function (a) {
    console.log("page init"); var d = a.detail; console.log(d.route.path); pageHistory.push(d.route.path); nowPageName = d.route.name; console.log(d.route.name); app.panel.enableSwipe(".panel-left"); $$(".back").on("click", handle_back); if ("home" != nowPageName) if ("pic-share-content" == nowPageName) console.log(d.route.query.index), LoadPicShareContent(d.route.query.index), $$(".submit-button").on("click", function () { NewPicShareComment(d.route.query.index) }); else if ("new-pic-share-post" ==
        nowPageName) document.querySelector("[data-page='new-pic-share'] .user-icon").src = userInfo.icon, document.querySelector("[data-page='new-pic-share'] .poster-name").innerText = userInfo.name; else if ("forum-article-content" == nowPageName) LoadForumArticleContent(d.route.query.index), $$(".submit-button").on("click", function () { NewForumComment(d.route.query.index) }); else if ("new-forum-article" == nowPageName) document.querySelector("[data-page='new-forum-article'] .user-icon").src = userInfo.icon, document.querySelector("[data-page='new-forum-article'] .poster-name").innerText =
            userInfo.name; else if ("help-content" == nowPageName) LoadHelpContent(d.route.query.index), $$(".submit-button").on("click", function () { NewHelpComment(d.route.query.index) }); else if ("new-help" == nowPageName) {
                document.querySelector("[data-page='new-help'] .user-icon").src = userInfo.icon; document.querySelector("[data-page='new-help'] .poster-name").innerText = userInfo.name; a = document.querySelectorAll('[data-page="new-help"] .emergency-rate'); for (var e = 0; e < a.length; e++)a[e].setAttribute("onclick", "SetEmergencyRate(" +
                    e + ")")
            } else if ("new-help-map-mark" == nowPageName) initNewHelpMap(), app.panel.disableSwipe(".panel-left"); else if ("fundraising-content" == nowPageName) LoadFundraisingContent(d.route.query.index); else if ("fundraising-update-content" == nowPageName) { var c = d.route.query.index; e = d.route.query.updateIndex; LoadFundraisingUpdateContent(c, e) } else "donate-payment-content" == nowPageName ? (c = d.route.query.index, LoadDonatePaymentContent(c, e)) : "select-payment" == nowPageName ? (c = d.route.query.index, a = d.route.query.name, nowChooseFundraising =
                c, nowChooseFundraisingName = a) : "chatroom-content" == nowPageName ? (c = d.route.query.index, listenChatroom(c), LoadChatroomContent(c), $('[data-page="page-content"] .back').onclick = function () { stopListenChatroom(c) }) : "noob-tutorial-content" == nowPageName ? (c = d.route.query.index, LoadTutorialContent(c)) : "donate-records" == nowPageName && loadDonateRecordsPage()
}); var pic_share_ptr = app.ptr.create('[data-page="pic-share"] .ptr-content'), $picSharePtrContent = $$('[data-page="pic-share"] .ptr-content');
$picSharePtrContent.on("ptr:refresh", function (a) { console.log("pull refresh"); isLoadingPicShare || (loadPicSharePage(-1, !0), console.log("refresh")) }); var forum_tab0_ptr = app.ptr.create('[data-page="forum"] #tab-0.ptr-content'), $forumTab0PtrContent = $$('[data-page="forum"] #tab-0.ptr-content'); $forumTab0PtrContent.on("ptr:refresh", function (a) { isLoadingPicShare || (loadForumPage(0, !0), console.log("refresh")) });
var forum_tab1_ptr = app.ptr.create('[data-page="forum"] #tab-1.ptr-content'), $forumTab1PtrContent = $$('[data-page="forum"] #tab-1.ptr-content'); $forumTab1PtrContent.on("ptr:refresh", function (a) { isLoadingPicShare || (loadForumPage(1, !0), console.log("refresh")) }); var forum_tab2_ptr = app.ptr.create('[data-page="forum"] #tab-2.ptr-content'), $forumTab2PtrContent = $$('[data-page="forum"] #tab-2.ptr-content'); $forumTab2PtrContent.on("ptr:refresh", function (a) { isLoadingPicShare || (loadForumPage(2, !0), console.log("refresh")) });
var forum_tab3_ptr = app.ptr.create('[data-page="forum"] #tab-3.ptr-content'), $forumTab3PtrContent = $$('[data-page="forum"] #tab-3.ptr-content'); $forumTab3PtrContent.on("ptr:refresh", function (a) { isLoadingPicShare || (loadForumPage(3, !0), console.log("refresh")) }); var help_ptr = app.ptr.create('[data-page="help"] .ptr-content'), $helpPtrContent = $$('[data-page="help"] .ptr-content'); $helpPtrContent.on("ptr:refresh", function (a) { isLoadingHelp || loadHelpPage(-1, !0) });
var fundraising_ptr = app.ptr.create('[data-page="fundraising"] .ptr-content'), $fundraisingPtrContent = $$('[data-page="fundraising"] .ptr-content'); $fundraisingPtrContent.on("ptr:refresh", function (a) { isLoadingFundraising || loadFundraisingPage(-1, !0) }); var chatroom_ptr = app.ptr.create('[data-page="chatroom"] .ptr-content'), $chatroomPtrContent = $$('[data-page="chatroom"] .ptr-content'); $chatroomPtrContent.on("ptr:refresh", function (a) { isLoadingChatroom || loadChatroomPage(-1) });
var hospital_ptr = app.ptr.create('[data-page="noob"] #tab-hospital.ptr-content'), $hospitalPtrContent = $$('[data-page="noob"] #tab-hospital.ptr-content'); $hospitalPtrContent.on("ptr:refresh", function (a) { console.log(isLoadingHospital); isLoadingHospital ? app.ptr.done($hospitalPtrContent) : LoadHospitalPage("", 0, !1, !0) }); var myPic_ptr = app.ptr.create('[data-page="my-post"] #tab-my-pic.ptr-content'), $myPicPtrContent = $$('[data-page="my-post"] #tab-my-pic.ptr-content'); $myPicPtrContent.on("ptr:refresh", function (a) { loadMyPic() });
var myForum_ptr = app.ptr.create('[data-page="my-post"] #tab-my-forum.ptr-content'), $myForumPtrContent = $$('[data-page="my-post"] #tab-my-forum.ptr-content'); $myForumPtrContent.on("ptr:refresh", function (a) { loadMyForum() }); var myHelp_ptr = app.ptr.create('[data-page="my-post"] #tab-my-help.ptr-content'), $myHelpPtrContent = $$('[data-page="my-post"] #tab-my-help.ptr-content'); $myHelpPtrContent.on("ptr:refresh", function (a) { loadMyHelp() });
function loadPicSharePage(a, d) { isLoadingPicShare ? app.ptr.done($picSharePtrContent) : (isLoadingPicShare = !0, GetPicShareList(a, function (a) { d && $$('[data-page="pic-share"] .page-content').scrollTop(0, 100); showPicShareList(a, d) })) }
function loadForumPage(a, d) { isLoadingForum[a] ? (app.ptr.done($forumTab0PtrContent), app.ptr.done($forumTab1PtrContent), app.ptr.done($forumTab2PtrContent), app.ptr.done($forumTab3PtrContent)) : (isLoadingForum[a] = !0, GetForumArticleList(a, function (e) { d && $$('[data-page="forum"] #tab-' + a + ".page-content").scrollTop(0, 100); for (i in e) console.log(e[i].title); showForumArticleList(e, a, d) })) }
function loadHelpPage(a, d) { console.log(isLoadingHelp); isLoadingHelp ? app.ptr.done($helpPtrContent) : (console.log("load help page"), isLoadingHelp = !0, GetHelpList(a, function (a) { d && $$('[data-page="help"] .page-content').scrollTop(0, 100); showHelpList(a, d) })) } var isLoadingFundraising;
function loadFundraisingPage(a, d) { console.log(isLoadingFundraising); isLoadingFundraising ? app.ptr.done($fundraisingPtrContent) : (console.log("load fundraising page"), isLoadingFundraising = !0, GetFundraisingList(a, function (a) { d && $$('[data-page="fundraising"] .page-content').scrollTop(0, 100); showFundraisingList(a, d) })) } var isLoadingChatroom;
function loadChatroomPage(a) { console.log(isLoadingChatroom); isLoadingChatroom ? app.ptr.done($chatroomPtrContent) : (console.log("load chatroom page"), isLoadingChatroom = !0, GetChatroomList(function (a) { $$('[data-page="chatroom"] .page-content').scrollTop(0, 100); showChatroomList(a) })) } var tutorialArticle;
function loadNoobPage() {
    console.log("load noob page"); if (void 0 == tutorialArticle) $.get("./tutorialArticle.json", function (a) {
        tutorialArticle = a; a = ""; for (var d = 0; d < tutorialArticle.length; d++) { console.log(d); var c = (new DOMParser).parseFromString(tutorialListItem, "text/html"); c.querySelector(".tutorial-link").href = "/noob-tutorial-content/?index=" + d; c.querySelector(".tutorial-list-title").innerText = tutorialArticle[d].title; a += c.querySelector(".tutorial-link").outerHTML } document.querySelector('[data-page = "noob"] .noob-tutorial-list').innerHTML =
            a
    }, "json"); else { console.log(tutorialArticle); for (var a = "", d = 0; d < tutorialArticle.length; d++) { var e = (new DOMParser).parseFromString(tutorialListItem, "text/html"); e.querySelector(".tutorial-link").href = "/noob-tutorial-content/?index=" + d; e.querySelector(".tutorial-list-title").innerText = tutorialArticle[d].title; a += e.querySelector(".tutorial-link").outerHTML } document.querySelector('[data-page = "noob"] .noob-tutorial-list').innerHTML = a }
}
function loadDonateRecordsPage() { GetDonateRecordsOfUser(userInfo.uid, function (a) { ShowDonateRecords(a) }) }
function ShowDonateRecords(a) {
    var d = ""; for (i in a) {
        var e = (new DOMParser).parseFromString(donateRecordListItem, "text/html"); e.querySelector(".donate-records-list-title").innerText = a[i].itemName; "true" == a[i].finishPay.toString() ? e.querySelector(".donate-state").innerText = "\u6350\u6b3e\u6210\u529f" : (new Date(a[i].expireDate)).getTime() < getNowTimeStamp() ? e.querySelector(".donate-state").innerText = "\u5df2\u904e\u671f" : (e.querySelector(".donate-state").innerText = "\u5f85\u7e73\u8cbb", e.querySelector(".donate-content-link").href =
            "/donate-payment-content/?index=" + i); e.querySelector(".donate-records-list-amount").innerText = "\u6350\u6b3e\u91d1\u984d\uff1a" + a[i].totalAmount; d += e.querySelector(".donate-content-link").outerHTML
    } document.querySelector('[data-page="donate-records"] .donate-records-list').innerHTML = d
} var isLoadingMyPic = !1, isLoadingMyForum = !1, isLoadingMyHelp = !1; function loadMyPost() { loadMyPic(); loadMyForum(); loadMyHelp() }
function loadMyPic() { isLoadingMyPic || GetPicShareListOfUser(userInfo.uid, function (a) { showMyPicList(a) }) } function loadMyForum() { isLoadingMyForum || GetForumListOfUser(userInfo.uid, function (a) { showMyForumArticleList(a) }) } function loadMyHelp() { isLoadingMyHelp || GetHelpListOfUser(userInfo.uid, function (a) { showMyHelpList(a) }) } var photoBrowsers = {}; function OpenPhotoBrowser(a) { photoBrowsers[a].openPopup() } app.infiniteScroll.create($$('[data-page="pic-share"] .page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="forum"] #tab-0.page-content.infinite-scroll-content'));
app.infiniteScroll.create($$('[data-page="forum"] #tab-1.page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="forum"] #tab-2.page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="forum"] #tab-3.page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="help"] .page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="fundraising"] .page-content.infinite-scroll-content')); app.infiniteScroll.create($$('[data-page="noob"] #tab-hospital.page-content.infinite-scroll-content'));
$$('[data-page="pic-share"] .infinite-scroll-content').on("infinite", function () { loadPicSharePage(nowPicShareIndex, !1) }); $$('[data-page="help"] .infinite-scroll-content').on("infinite", function () { loadHelpPage(nowHelpIndex, !1) }); $$('[data-page="fundraising"] .infinite-scroll-content').on("infinite", function () { loadFundraisingPage(nowFundraisingIndex, !1) }); $$('[data-page="noob"] #tab-hospital.infinite-scroll-content').on("infinite", function () { LoadHospitalPage("", nowHospitalIndex, !1, !1) });
function showPicShareList(a, d) {
    if (void 0 == a || null == a) console.log("\u6c92\u6709\u66f4\u591a\u6587\u7ae0"), app.infiniteScroll.destroy('[data-page="pic-share"] .infinite-scroll-content'), document.querySelector("[data-page='pic-share'] .infinite-scroll-preloader").style.display = "none"; else {
        nowPicShareIndex = a[Object.getOwnPropertyNames(a)[0]].time - 1; var e = getNowTimeStamp(); if ("" == picShareItemStr) $.get("pages/elements/pic-share-item.html", function (c) {
            picShareItemStr = c; c = ""; console.log("start initial list");
            for (i in a) {
                var b = (new DOMParser).parseFromString(picShareItemStr, "text/html"); b.querySelector(".poster-name").id = a[i].poster + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".pic-share-content-text").innerText = a[i].content; var h = 0, f = 0; void 0 != a[i].likes ? (h = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick",
                    "OnPicShareCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (f = Object.getOwnPropertyNames(a[i].comments).length); b.querySelectorAll(".article-footer-count-text")[0].innerText =
                        h; b.querySelectorAll(".article-footer-count-text")[1].innerText = f; b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background = a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" + i; b.querySelector(".pic-post-time").innerText = timedifference(a[i].time, e); b.querySelector(".user-icon").id = a[i].poster + "-icon"; b.querySelector(".content-link").href = "/pic-share-content/?index=" + i; c = b.querySelector(".pic-item").outerHTML + c
            } d ? $(".pic-share-list").html(c) :
                $(".pic-share-list").append(c); app.lazy.create($$(".pic-container lazy")); $$(".pic-container lazy").trigger("lazy"); isLoadingPicShare = !1; for (i in a) c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")'), GetUserInfo(a[i].poster, function (a, d) {
                    var c = document.querySelector("[data-page='pic-share'] #" + d + "-icon"), b = document.querySelector("[data-page='pic-share'] #" + d + "-name"); null != c &&
                        (console.log(a.icon), c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "")
                }); console.log("finish first show")
        }); else {
            var c = ""; for (i in a) {
                var b = (new DOMParser).parseFromString(picShareItemStr, "text/html"); b.querySelector(".poster-name").id = a[i].poster + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".pic-share-content-text").innerText = a[i].content; console.log(a[i].content); var g = 0, f = 0; void 0 != a[i].likes ? (g = Object.getOwnPropertyNames(a[i].likes).length,
                    null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick",
                        "OnPicShareLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (f = Object.getOwnPropertyNames(a[i].comments).length); b.querySelectorAll(".article-footer-count-text")[0].innerText = g; b.querySelectorAll(".article-footer-count-text")[1].innerText = f; b.querySelector(".pic-post-time").innerText = timedifference(a[i].time, e); b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background = a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" +
                            i; b.querySelector(".user-icon").id = a[i].poster + "-icon"; b.querySelector(".content-link").href = "/pic-share-content/?index=" + i; c = b.querySelector(".pic-item").outerHTML + c
            } d && $(".pic-share-list").html(""); $(".pic-share-list").append(c); app.lazy.create($$(".pic-container lazy")); $$(".pic-container lazy").trigger("lazy"); for (i in a) GetUserInfo(a[i].poster, function (a, d) {
                var c = document.querySelector("[data-page='pic-share'] #" + d + "-icon"), b = document.querySelector("[data-page='pic-share'] #" + d + "-name"); null !=
                    c && (c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "")
            }), c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")'); console.log("finish reload")
        }
    } app.ptr.done($fundraisingPtrContent); isLoadingPicShare = !1
}
function showMyPicList(a) {
    if (void 0 == a || null == a) $("[data-page='my-post'] .my-pic-list").html(""), app.ptr.done($myPicPtrContent), isLoadingMyPic = !1; else {
        var d = getNowTimeStamp(); if ("" == picShareItemStr) $.get("pages/elements/pic-share-item.html", function (c) {
            picShareItemStr = c; c = ""; for (i in a) {
                var b = (new DOMParser).parseFromString(picShareItemStr, "text/html"); b.querySelector(".poster-name").innerText = userInfo.name; b.querySelector(".pic-share-content-text").innerText = a[i].content; var e = 0, f = 0; void 0 != a[i].likes ?
                    (e = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), b.querySelector("#like-icon").setAttribute("src", "img/like.png"),
                        b.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (f = Object.getOwnPropertyNames(a[i].comments).length); b.querySelectorAll(".article-footer-count-text")[0].innerText = e; b.querySelectorAll(".article-footer-count-text")[1].innerText = f; b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background = a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" + i; b.querySelector(".pic-post-time").innerText =
                            timedifference(a[i].time, d); b.querySelector(".user-icon").src = userInfo.icon; b.querySelector(".content-link").href = "/pic-share-content/?index=" + i; c = b.querySelector(".pic-item").outerHTML + c
            } $("[data-page='my-post'] .my-pic-list").html(c); app.lazy.create($$('[data-page="my-post"] .pic-container lazy')); $$(".pic-container lazy").trigger("lazy"); isLoadingMyPic = !1; for (i in a) c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("[data-page='my-post'] #pic-share-img-" +
                i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")')
        }); else {
            var e = ""; for (i in a) {
                var c = (new DOMParser).parseFromString(picShareItemStr, "text/html"); c.querySelector(".poster-name").innerText = userInfo.name; c.querySelector(".pic-share-content-text").innerText = a[i].content; var b = 0, g = 0; void 0 != a[i].likes ? (b = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (c.querySelector("#like-icon").setAttribute("src", "img/liked.png"), c.querySelector("#like-link").setAttribute("onclick",
                    "OnPicShareCancelLikePressed(this, '" + i + "')")) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (g = Object.getOwnPropertyNames(a[i].comments).length); c.querySelectorAll(".article-footer-count-text")[0].innerText =
                        b; c.querySelectorAll(".article-footer-count-text")[1].innerText = g; c.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; c.querySelector(".pic-container").dataset.background = a[i].img; c.querySelector(".pic-container").id = "pic-share-img-" + i; c.querySelector(".pic-post-time").innerText = timedifference(a[i].time, d); c.querySelector(".user-icon").src = userInfo.icon; c.querySelector(".content-link").href = "/pic-share-content/?index=" + i; e = c.querySelector(".pic-item").outerHTML + e
            } $("[data-page='my-post'] .my-pic-list").html(e);
            app.lazy.create($$('[data-page="my-post"] .pic-container lazy')); $$(".pic-container lazy").trigger("lazy"); isLoadingMyPic = !1; for (i in a) e = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = e, document.querySelector("[data-page='my-post'] #pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")')
        } app.ptr.done($myPicPtrContent)
    }
}
function LoadPicShareContent(a) {
    GetPicShareArticle(a, function (d) {
        var e = getNowTimeStamp(), c = (new DOMParser).parseFromString(picShareItemStr, "text/html"); c.querySelector(".poster-name").id = d.poster + "-name"; c.querySelector(".pic-share-content-text").innerText = d.content; console.log("finish get article"); var b = 0, g = 0; console.log(JSON.stringify(d)); void 0 != d.likes ? (b = Object.getOwnPropertyNames(d.likes).length, null != d.likes[userInfo.uid] ? (c.querySelector("#like-icon").setAttribute("src", "img/liked.png"),
            c.querySelector("#like-link").setAttribute("onclick", "OnPicShareCancelLikePressed(this, '" + a + "')")) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + a + "')"))) : (console.log("add like listener"), c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnPicShareLikePressed(this, '" + a + "')")); void 0 != d.comments && (g = Object.getOwnPropertyNames(d.comments).length);
        var f = d.comments; void 0 != f && ShowPicShareComments(f); c.querySelector(".pic-post-time").innerText = timedifference(d.time, e); c.querySelectorAll(".article-footer-count-text")[0].innerText = b; c.querySelectorAll(".article-footer-count-text")[1].innerText = g; c.querySelector(".pic-container").style.backgroundImage = "url(" + d.img + ")"; c.querySelector(".user-icon").id = d.poster + "-icon"; GetUserInfo(d.poster, function (a) {
            $(".page[data-page='pic-share-content'] .pic-item").html(c.querySelector(".pic-item").innerHTML);
            document.querySelector('[data-page = "pic-share-content"] .new-comment-item .user-icon').src = userInfo.icon; var b = app.photoBrowser.create({ photos: [d.img], theme: "dark" }); document.querySelector("[data-page='pic-share-content'] .pic-container").onclick = function () { b.openPopup() }; var e = document.querySelector(".page[data-page='pic-share-content'] #" + d.poster + "-icon"), f = document.querySelector(".page[data-page='pic-share-content'] #" + d.poster + "-name"); console.log("icon: " + a.icon); null != e && (e.src = a.icon, e.id =
                ""); null != f && (f.innerText = a.name, f.id = "")
        })
    })
}
function ShowPicShareComments(a) {
    var d = getNowTimeStamp(); $(".page[data-page='pic-share-content'] .pic-share-comments").html(""); if ("" == commentItemStr) $.get("pages/elements/comment-item.html", function (c) {
        commentItemStr = c; for (i in a) {
            c = a[i].poster; var b = a[i].content, e = (new DOMParser).parseFromString(commentItemStr, "text/html"); e.querySelector(".post-time").innerText = timedifference(a[i].time, d); e.querySelector(".poster-name").id = "comment-" + c + "-name"; e.querySelector(".user-link").href = "/chatroom-content/?index=" +
                a[i].poster; e.querySelector(".comment-content").innerText = b; e.querySelector(".user-icon").id = "comment-" + c + "-icon"; $(".page[data-page='pic-share-content'] .pic-share-comments").append(e.querySelector(".comment-item").outerHTML); GetUserInfo(c, function (a, d) { var c = document.querySelector(".page[data-page='pic-share-content'] #comment-" + d + "-icon"), b = document.querySelector(".page[data-page='pic-share-content'] #comment-" + d + "-name"); null != c && (c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "") })
        }
    });
    else for (i in a) {
        var e = a[i].poster, c = a[i].content, b = (new DOMParser).parseFromString(commentItemStr, "text/html"); b.querySelector(".post-time").innerText = timedifference(a[i].time, d); b.querySelector(".poster-name").id = "comment-" + e + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".comment-content").innerText = c; b.querySelector(".user-icon").id = "comment-" + e + "-icon"; $(".page[data-page='pic-share-content'] .pic-share-comments").append(b.querySelector(".comment-item").outerHTML);
        GetUserInfo(e, function (a, d) { var c = document.querySelector(".page[data-page='pic-share-content'] #comment-" + d + "-icon"), b = document.querySelector(".page[data-page='pic-share-content'] #comment-" + d + "-name"); null != c && (c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "") })
    }
} var forumListItemStr = "";
function showForumArticleList(a, d, e) {
    if (void 0 == a || null == a) console.log("\u6c92\u6709\u66f4\u591a\u6587\u7ae0"), console.log(d), app.infiniteScroll.destroy('[data-page="forum"] #tab-' + d + ".infinite-scroll-content"); else if (getNowTimeStamp(), "" == forumListItemStr) $.get("pages/elements/forum-article-list-item.html", function (c) {
        forumListItemStr = c; c = ""; console.log("start initial list"); for (i in a) {
            var b = (new DOMParser).parseFromString(forumListItemStr, "text/html"); b.querySelector(".forum-article-list-item-title").innerText =
                a[i].title; var f = 0; void 0 != a[i].likes && (f = Object.getOwnPropertyNames(a[i].likes).length); b.querySelector(".forum-article-comment-count").innerText = f; b.querySelector(".forum-article-content-link").href = "/forum-article-content/?index=" + i; c = b.querySelector(".forum-article-content-link").outerHTML + c
        } e ? $("#tab-" + d + " .forum-article-list").html(c) : $("tab-" + d + " .forum-article-list").append(c); isLoadingForum[d] = !1
    }); else {
        var c = ""; console.log("start initial list"); for (i in a) {
            var b = (new DOMParser).parseFromString(forumListItemStr,
                "text/html"); b.querySelector(".forum-article-list-item-title").innerText = a[i].title; var g = 0; void 0 != a[i].likes && (g = Object.getOwnPropertyNames(a[i].likes).length); b.querySelector(".forum-article-comment-count").innerText = g; b.querySelector(".forum-article-content-link").href = "/forum-article-content/?index=" + i; c = b.querySelector(".forum-article-content-link").outerHTML + c
        } e ? $("#tab-" + d + " .forum-article-list").html(c) : $("tab-" + d + " .forum-article-list").append(c); console.log(c); isLoadingForum[d] = !1; console.log("_____tab-" +
            d)
    } app.ptr.done($forumTab0PtrContent); app.ptr.done($forumTab1PtrContent); app.ptr.done($forumTab2PtrContent); app.ptr.done($forumTab3PtrContent); isLoadingForum[d] = !1
}
function showMyForumArticleList(a) {
    if (void 0 == a || null == a) isLoadingMyForum = !1; else if (getNowTimeStamp(), "" == forumListItemStr) $.get("pages/elements/forum-article-list-item.html", function (d) {
        forumListItemStr = d; d = ""; console.log("start initial list"); for (i in a) {
            var c = (new DOMParser).parseFromString(forumListItemStr, "text/html"); c.querySelector(".forum-article-list-item-title").innerText = a[i].title; var b = 0; void 0 != a[i].likes && (b = Object.getOwnPropertyNames(a[i].likes).length); c.querySelector(".forum-article-comment-count").innerText =
                b; c.querySelector(".forum-article-content-link").href = "/forum-article-content/?index=" + i; d = c.querySelector(".forum-article-content-link").outerHTML + d
        } $("[data-page='my-post'] #tab-my-forum .my-forum-list").html(d); isLoadingMyForum = !1
    }); else {
        var d = ""; console.log("start initial list"); for (i in a) {
            var e = (new DOMParser).parseFromString(forumListItemStr, "text/html"); e.querySelector(".forum-article-list-item-title").innerText = a[i].title; var c = 0; void 0 != a[i].likes && (c = Object.getOwnPropertyNames(a[i].likes).length);
            e.querySelector(".forum-article-comment-count").innerText = c; e.querySelector(".forum-article-content-link").href = "/forum-article-content/?index=" + i; d = e.querySelector(".forum-article-content-link").outerHTML + d
        } $("[data-page='my-post'] #tab-my-forum .my-forum-list").html(d); isLoadingMyForum = !1
    } app.ptr.done($myForumPtrContent)
}
function LoadForumArticleContent(a) {
    GetForumArticle(a, function (d) {
        document.querySelector("[data-page='forum-article-content'] .navbar .title").innerText = d.title; var e = getNowTimeStamp(), c = (new DOMParser).parseFromString(forumArticleItemStr, "text/html"); c.querySelector(".poster-name").id = d.poster + "-name"; c.querySelector(".user-link").href = "/chatroom-content/?index=" + d.poster; c.querySelector(".classify").innerText = GetForumClassifyName(d.classify); c.querySelector(".article-title").innerText = d.title; c.querySelector(".forum-content-text").innerText =
            d.content; void 0 != d.img && "" != d.img && (c.querySelector(".forum-main .pic-container").style.backgroundImage = "url(" + d.img + ")", c.querySelector(".forum-main .pic-container").style.display = "block"); console.log("finish get article"); var b = 0, g = 0; console.log(JSON.stringify(d)); void 0 != d.likes ? (b = Object.getOwnPropertyNames(d.likes).length, null != d.likes[userInfo.uid] ? (c.querySelector("#like-icon").setAttribute("src", "img/liked.png"), c.querySelector("#like-link").setAttribute("onclick", "OnForumCancelLikePressed(this, '" +
                a + "')")) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnForumLikePressed(this, '" + a + "')"))) : (console.log("add like listener"), c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnForumLikePressed(this, '" + a + "')")); void 0 != d.comments && (g = Object.getOwnPropertyNames(d.comments).length); var f = d.comments; void 0 != f && ShowForumComments(f); c.querySelector(".forum-post-time").innerText =
                    timedifference(d.time, e); c.querySelectorAll(".article-footer-count-text")[0].innerText = b; c.querySelectorAll(".article-footer-count-text")[1].innerText = g; c.querySelector(".user-icon").id = d.poster + "-icon"; GetUserInfo(d.poster, function (a) {
                        $(".page[data-page='forum-article-content'] .forum-item").html(c.querySelector(".forum-item").innerHTML); document.querySelector('[data-page = "forum-article-content"] .new-comment-item .user-icon').src = userInfo.icon; var b = app.photoBrowser.create({ photos: [d.img], theme: "dark" });
                        document.querySelector("[data-page='forum-article-content'] .pic-container").onclick = function () { b.openPopup() }; var e = document.querySelector("[data-page='forum-article-content'] #" + d.poster + "-icon"), f = document.querySelector("[data-page='forum-article-content'] #" + d.poster + "-name"); null != e && (e.src = a.icon, e.id = ""); null != f && (f.innerText = a.name, f.id = "")
                    })
    })
}
function ShowForumComments(a) {
    var d = getNowTimeStamp(); $(".page[data-page='forum-article-content'] .forum-comments").html(""); if ("" == commentItemStr) $.get("pages/elements/comment-item.html", function (c) {
        commentItemStr = c; for (i in a) {
            c = a[i].poster; var b = a[i].content, e = (new DOMParser).parseFromString(commentItemStr, "text/html"); e.querySelector(".poster-name").id = c + "-name"; e.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; e.querySelector(".comment-content").innerText = b; e.querySelector(".user-icon").id =
                c + "-icon"; e.querySelector(".post-time").innerText = timedifference(a[i].time, d); $(".page[data-page='forum-article-content'] .forum-comments").append(e.querySelector(".comment-item").outerHTML); GetUserInfo(c, function (a, d) { var c = document.querySelector("[data-page='forum-article-content'] #" + d + "-icon"), b = document.querySelector("[data-page='forum-article-content'] #" + d + "-name"); null != c && (c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "") })
        }
    }); else for (i in a) {
        var e = a[i].poster, c = a[i].content, b =
            (new DOMParser).parseFromString(commentItemStr, "text/html"); b.querySelector(".poster-name").id = e + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".comment-content").innerText = c; b.querySelector(".user-icon").id = e + "-icon"; b.querySelector(".post-time").innerText = timedifference(a[i].time, d); $(".page[data-page='forum-article-content'] .forum-comments").append(b.querySelector(".comment-item").outerHTML); GetUserInfo(e, function (a, d) {
                var c = document.querySelector("[data-page='forum-article-content'] #" +
                    d + "-icon"), b = document.querySelector("[data-page='forum-article-content'] #" + d + "-name"); null != c && (c.src = a.icon, c.id = ""); null != b && (b.innerText = a.name, b.id = "")
            })
    }
} function ReloadAllForumList() { loadForumPage(0, !0); loadForumPage(1, !0); loadForumPage(2, !0); loadForumPage(3, !0) } nowHelpIndex = -1;
function showHelpList(a, d) {
    console.log("show help"); d && (document.querySelector("[data-page='help'] .infinite-scroll-preloader").style.display = "block"); if (void 0 == a || null == a) console.log("\u6c92\u6709\u66f4\u591a\u6587\u7ae0"), app.infiniteScroll.destroy('[data-page="help"] .infinite-scroll-content'), document.querySelector("[data-page='help'] .infinite-scroll-preloader").style.display = "none"; else {
        console.log("show help list"); nowHelpIndex = a[Object.getOwnPropertyNames(a)[0]].time - 1; var e = getNowTimeStamp();
        if ("" == helpItemStr) $.get("pages/elements/help-item.html", function (c) {
            helpItemStr = c; c = ""; console.log("start initial list"); for (i in a) {
                var b = (new DOMParser).parseFromString(helpItemStr, "text/html"); b.querySelector(".poster-name").id = a[i].poster + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".help-content-text").innerText = a[i].content; console.log(a[i].position); var f = a[i].position; b.querySelector(".map-link").setAttribute("onclick", "OpenGoogleMapApp(" +
                    f.lat + "," + f.lng + ")"); var g = f = 0; void 0 != a[i].likes ? (f = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), b.querySelector("#like-icon").setAttribute("src",
                        "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (g = Object.getOwnPropertyNames(a[i].comments).length); for (var h = b.querySelectorAll(".emergency-rate"), k = 0; k <= a[i].emergency; k++)h[k].src = "img/syringe_fill.png"; b.querySelectorAll(".article-footer-count-text")[0].innerText = f; b.querySelectorAll(".article-footer-count-text")[1].innerText = g; b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background =
                            a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" + i; b.querySelector(".help-post-time").innerText = timedifference(a[i].time, e); b.querySelector(".location-name").innerText = a[i].position_name; void 0 != a[i].isSaved && (b.querySelector(".chip-label.classify").innerText = "\u5df2\u6551\u63f4\u5b8c\u6210"); b.querySelector(".user-icon").id = a[i].poster + "-icon"; b.querySelector(".content-link").href = "/help-content/?index=" + i; c = b.querySelector(".help-item").outerHTML + c
            } d ? $(".help-list").html(c) : $(".help-list").append(c);
            app.lazy.create($$(".pic-container lazy")); $$(".pic-container lazy").trigger("lazy"); isLoadingPicShare = !1; for (i in a) c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")'), GetUserInfo(a[i].poster, function (d, c) {
                console.log(a[i].poster); var b = document.querySelector("[data-page='help'] #" + c + "-icon"), e = document.querySelector("[data-page='help'] #" + c + "-name"); null != b && (console.log(d.icon),
                    b.src = d.icon, b.id = ""); null != e && (e.innerText = d.name, e.id = "")
            }); console.log("finish first show")
        }); else {
            var c = ""; console.log("start initial list"); for (i in a) {
                var b = (new DOMParser).parseFromString(helpItemStr, "text/html"); b.querySelector(".poster-name").id = a[i].poster + "-name"; b.querySelector(".user-link").href = "/chatroom-content/?index=" + a[i].poster; b.querySelector(".help-content-text").innerText = a[i].content; var g = a[i].position; b.querySelector(".map-link").setAttribute("onclick", "OpenGoogleMapApp(" +
                    g.lat + "," + g.lng + ")"); var f = g = 0; void 0 != a[i].likes ? (g = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')"))) : (console.log("add like listener"), b.querySelector("#like-icon").setAttribute("src",
                        "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (f = Object.getOwnPropertyNames(a[i].comments).length); for (var h = b.querySelectorAll(".emergency-rate"), k = 0; k <= a[i].emergency; k++)h[k].src = "img/syringe_fill.png"; b.querySelectorAll(".article-footer-count-text")[0].innerText = g; b.querySelectorAll(".article-footer-count-text")[1].innerText = f; b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background =
                            a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" + i; b.querySelector(".help-post-time").innerText = timedifference(a[i].time, e); b.querySelector(".location-name").innerText = a[i].position_name; void 0 != a[i].isSaved && (b.querySelector(".chip-label.classify").innerText = "\u5df2\u6551\u63f4\u5b8c\u6210"); b.querySelector(".user-icon").id = a[i].poster + "-icon"; b.querySelector(".content-link").href = "/help-content/?index=" + i; c = b.querySelector(".help-item").outerHTML + c
            } d ? $(".help-list").html(c) : $(".help-list").append(c);
            app.lazy.create($$(".pic-container lazy")); $$(".pic-container lazy").trigger("lazy"); isLoadingPicShare = !1; for (i in a) c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")'), GetUserInfo(a[i].poster, function (d, c) {
                console.log(a[i].poster); var b = document.querySelector("[data-page='help'] #" + c + "-icon"), e = document.querySelector("[data-page='help'] #" + c + "-name"); null != b && (console.log(d.icon),
                    b.src = d.icon, b.id = ""); null != e && (e.innerText = d.name, e.id = "")
            }); console.log("finish first show")
        }
    } app.ptr.done($helpPtrContent); isLoadingHelp = !1
}
function showMyHelpList(a) {
    console.log("show help"); if (void 0 == a || null == a) app.ptr.done($myHelpPtrContent), isLoadingMyHelp = !1; else {
        console.log("show help list"); var d = getNowTimeStamp(); if ("" == helpItemStr) $.get("pages/elements/help-item.html", function (c) {
            helpItemStr = c; c = ""; console.log("start initial list"); console.log(a); for (i in a) {
                var b = (new DOMParser).parseFromString(helpItemStr, "text/html"); b.querySelector(".poster-name").innerText = userInfo.name; b.querySelector(".help-content-text").innerText = a[i].content;
                var e = a[i].position; b.querySelector(".map-link").setAttribute("onclick", "OpenGoogleMapApp(" + e.lat + "," + e.lng + ")"); var f = e = 0; void 0 != a[i].likes ? (e = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (b.querySelector("#like-icon").setAttribute("src", "img/liked.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpCancelLikePressed(this, '" + i + "')")) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick",
                    "OnHelpLikePressed(this, '" + i + "')"))) : (b.querySelector("#like-icon").setAttribute("src", "img/like.png"), b.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (f = Object.getOwnPropertyNames(a[i].comments).length); for (var g = b.querySelectorAll(".emergency-rate"), h = 0; h <= a[i].emergency; h++)g[h].src = "img/syringe_fill.png"; b.querySelectorAll(".article-footer-count-text")[0].innerText = e; b.querySelectorAll(".article-footer-count-text")[1].innerText =
                        f; b.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; b.querySelector(".pic-container").dataset.background = a[i].img; b.querySelector(".pic-container").id = "pic-share-img-" + i; b.querySelector(".help-post-time").innerText = timedifference(a[i].time, d); b.querySelector(".location-name").innerText = a[i].position_name; void 0 != a[i].isSaved && (b.querySelector(".chip-label.classify").innerText = "\u5df2\u6551\u63f4\u5b8c\u6210"); b.querySelector(".user-icon").src = userInfo.icon; b.querySelector(".content-link").href =
                            "/help-content/?index=" + i; c = b.querySelector(".help-item").outerHTML + c
            } $("[data-page='my-post'] .my-help-list").html(c); app.lazy.create($$('[data-page="my-post"] .pic-container lazy')); $$('[data-page="my-post"] .pic-container lazy').trigger("lazy"); isLoadingMyHelp = !1; for (i in a) c = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }), photoBrowsers[i] = c, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")')
        }); else {
            var e = ""; console.log("start initial list");
            for (i in a) {
                var c = (new DOMParser).parseFromString(helpItemStr, "text/html"); c.querySelector(".poster-name").innerText = userInfo.name; c.querySelector(".help-content-text").innerText = a[i].content; var b = a[i].position; c.querySelector(".map-link").setAttribute("onclick", "OpenGoogleMapApp(" + b.lat + "," + b.lng + ")"); var g = b = 0; void 0 != a[i].likes ? (b = Object.getOwnPropertyNames(a[i].likes).length, null != a[i].likes[userInfo.uid] ? (c.querySelector("#like-icon").setAttribute("src", "img/liked.png"), c.querySelector("#like-link").setAttribute("onclick",
                    "OnHelpCancelLikePressed(this, '" + i + "')")) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')"))) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + i + "')")); void 0 != a[i].comments && (g = Object.getOwnPropertyNames(a[i].comments).length); for (var f = c.querySelectorAll(".emergency-rate"), h = 0; h <= a[i].emergency; h++)f[h].src =
                        "img/syringe_fill.png"; c.querySelectorAll(".article-footer-count-text")[0].innerText = b; c.querySelectorAll(".article-footer-count-text")[1].innerText = g; c.querySelector(".pic-container").style.backgroundImage = "url(" + a[i].img + ")"; c.querySelector(".pic-container").dataset.background = a[i].img; c.querySelector(".pic-container").id = "pic-share-img-" + i; c.querySelector(".help-post-time").innerText = timedifference(a[i].time, d); c.querySelector(".location-name").innerText = a[i].position_name; void 0 != a[i].isSaved &&
                            (c.querySelector(".chip-label.classify").innerText = "\u5df2\u6551\u63f4\u5b8c\u6210"); c.querySelector(".user-icon").src = userInfo.icon; c.querySelector(".content-link").href = "/help-content/?index=" + i; e = c.querySelector(".help-item").outerHTML + e
            } $("[data-page='my-post'] .my-help-list").html(e); app.lazy.create($$('[data-page="my-post"] .pic-container lazy')); $$('[data-page="my-post"] .pic-container lazy').trigger("lazy"); isLoadingMyHelp = !1; for (i in a) e = app.photoBrowser.create({ photos: [a[i].img], theme: "dark" }),
                photoBrowsers[i] = e, document.querySelector("#pic-share-img-" + i).setAttribute("onclick", 'OpenPhotoBrowser("' + i + '")')
        } app.ptr.done($myHelpPtrContent)
    }
}
function LoadHelpContent(a) {
    GetHelpArticle(a, function (d) {
        var e = getNowTimeStamp(), c = (new DOMParser).parseFromString(helpItemStr, "text/html"); c.querySelector(".poster-name").id = d.poster + "-name"; c.querySelector(".help-content-text").innerText = d.content; var b = d.position; c.querySelector(".map-link").setAttribute("onclick", "OpenGoogleMapApp(" + b.lat + "," + b.lng + ")"); c.querySelector(".location-name").innerText = d.position_name; console.log("finish get article"); var g = b = 0; console.log(JSON.stringify(d)); void 0 !=
            d.likes ? (b = Object.getOwnPropertyNames(d.likes).length, null != d.likes[userInfo.uid] ? (c.querySelector("#like-icon").setAttribute("src", "img/liked.png"), c.querySelector("#like-link").setAttribute("onclick", "OnHelpCancelLikePressed(this, '" + a + "')")) : (c.querySelector("#like-icon").setAttribute("src", "img/like.png"), c.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + a + "')"))) : (console.log("add like listener"), c.querySelector("#like-icon").setAttribute("src", "img/like.png"),
                c.querySelector("#like-link").setAttribute("onclick", "OnHelpLikePressed(this, '" + a + "')"), c.querySelector(".location-name").innerText = d.position_name); void 0 != d.comments && (g = Object.getOwnPropertyNames(d.comments).length); var f = d.comments; void 0 != f && ShowHelpComments(f); f = c.querySelectorAll(".emergency-rate"); for (var h = 0; h <= d.emergency; h++)f[h].src = "img/syringe_fill.png"; c.querySelector(".help-post-time").innerText = timedifference(d.time, e); c.querySelectorAll(".article-footer-count-text")[0].innerText =
                    b; c.querySelectorAll(".article-footer-count-text")[1].innerText = g; c.querySelector(".pic-container").style.backgroundImage = "url(" + d.img + ")"; void 0 != d.isSaved && (c.querySelector(".chip-label.classify").innerText = "\u5df2\u6551\u63f4\u5b8c\u6210"); c.querySelector(".user-icon").id = d.poster + "-icon"; GetUserInfo(d.poster, function (b) {
                        $(".page[data-page='help-content'] .help-item").html(c.querySelector(".help-item").innerHTML); document.querySelector('[data-page = "help-content"] .new-comment-item .user-icon').src =
                            userInfo.icon; document.querySelector('[data-page="help-content"] .report-help-button').setAttribute("onclick", "ReportHelp('" + a + "')"); void 0 != d.isSaved && (document.querySelector('[data-page="help-content"] .report-help-button').style.display = "none"); var e = document.querySelector(".page[data-page='help-content'] #" + d.poster + "-icon"), f = document.querySelector(".page[data-page='help-content'] #" + d.poster + "-name"), g = app.photoBrowser.create({ photos: [d.img], theme: "dark" }); document.querySelector("[data-page='help-content'] .pic-container").onclick =
                                function () { g.openPopup() }; console.log("icon: " + b.icon); null != e && (e.src = b.icon, e.id = ""); null != f && (f.innerText = b.name, f.id = "")
                    })
    })
}
function ShowHelpComments(a) {
    var d = getNowTimeStamp(); $(".page[data-page='help-content'] .help-comments").html(""); if ("" == commentItemStr) $.get("pages/elements/comment-item.html", function (b) {
        commentItemStr = b; for (i in a) {
            b = a[i].poster; var c = a[i].content, e = (new DOMParser).parseFromString(commentItemStr, "text/html"); e.querySelector(".poster-name").id = b + "-name"; e.querySelector(".comment-content").innerText = c; e.querySelector(".user-icon").id = b + "-icon"; e.querySelector(".post-time").innerText = timedifference(a[i].time,
                d); $(".page[data-page='help-content'] .help-comments").append(e.querySelector(".comment-item").outerHTML); GetUserInfo(b, function (a, b) { var d = document.querySelector("[data-page='help-content'] #" + b + "-icon"), c = document.querySelector("[data-page='help-content'] #" + b + "-name"); null != d && (d.src = a.icon, d.id = ""); null != c && (c.innerText = a.name, c.id = "") })
        }
    }); else for (i in a) {
        var e = a[i].poster, c = a[i].content, b = (new DOMParser).parseFromString(commentItemStr, "text/html"); b.querySelector(".poster-name").id = e + "-name";
        b.querySelector(".comment-content").innerText = c; b.querySelector(".user-icon").id = e + "-icon"; b.querySelector(".post-time").innerText = timedifference(a[i].time, d); $(".page[data-page='help-content'] .help-comments").append(b.querySelector(".comment-item").outerHTML); GetUserInfo(e, function (a, d) { var b = document.querySelector("[data-page='help-content'] #" + d + "-icon"), c = document.querySelector("[data-page='help-content'] #" + d + "-name"); null != b && (b.src = a.icon, b.id = ""); null != c && (c.innerText = a.name, c.id = "") })
    }
}
var emergencyRate = 4; function SetEmergencyRate(a) { emergencyRate = a; for (var d = document.querySelectorAll('[data-page="new-help"] .emergency-rate'), e = 0; e < d.length; e++)d[e].src = "img/syringe_empty.png"; for (e = 0; e <= a; e++)d[e].src = "img/syringe_fill.png" } var nowFundraisingIndex = -1, fundraisingListItem = "";
function showFundraisingList(a, d) {
    if (void 0 != a && null != a) {
    10 > a.length && (console.log(a.length), console.log("\u6c92\u6709\u66f4\u591a\u6587\u7ae0"), app.infiniteScroll.destroy('[data-page="fundraising"] .infinite-scroll-content'), document.querySelector("[data-page='fundraising'] .infinite-scroll-preloader").style.display = "none", app.ptr.done($fundraisingPtrContent)); console.log("show help list"); nowFundraisingIndex = a[Object.getOwnPropertyNames(a)[0]].time - 1; var e = getNowTimeStamp(); if ("" == fundraisingListItem) $.get("pages/elements/fundraising-list-item.html",
        function (b) {
            fundraisingListItem = b; b = ""; console.log("start initial list"); for (i in a) {
                var c = (new DOMParser).parseFromString(fundraisingListItem, "text/html"); c.querySelector(".fundraising-list-item-title").innerText = a[i].title; c.querySelector(".donate-target").innerText = a[i].target; c.querySelector(".donate-now").innerText = a[i].now; c.querySelector(".donate-count").innerText = a[i].nowPeople; var f = parseInt(a[i].now) / parseInt(a[i].target) * 100; c.querySelector(".donate-bar-inner").style.width = f + "%"; c.querySelector(".post-time").innerText =
                    timedifference(a[i].time, e); c.querySelector(".content-link").href = "/fundraising-content/?index=" + i; b = c.querySelector(".content-link").outerHTML + b
            } d ? $(".fundraising-list").html(b) : $(".fundraising-list").append(b); isLoadingFundraising = !1
        }); else {
            var c = ""; console.log("start initial list"); for (i in a) {
                var b = (new DOMParser).parseFromString(fundraisingListItem, "text/html"); b.querySelector(".fundraising-list-item-title").innerText = a[i].title; b.querySelector(".donate-target").innerText = a[i].target; b.querySelector(".donate-now").innerText =
                    a[i].now; b.querySelector(".donate-count").innerText = a[i].nowPeople; var g = parseInt(a[i].now) / parseInt(a[i].target) * 100; b.querySelector(".donate-bar-inner").style.width = g + "%"; b.querySelector(".post-time").innerText = timedifference(a[i].time, e); b.querySelector(".content-link").href = "/fundraising-content/?index=" + i; c = b.querySelector(".content-link").outerHTML + c
            } d ? $(".fundraising-list").html(c) : $(".fundraising-list").append(c); isLoadingFundraising = !1
    } app.ptr.done($fundraisingPtrContent)
    } isLoadingFundraising =
        !1
}
function LoadFundraisingContent(a) {
    GetFundraisingArticle(a, function (d) {
        var e = getNowTimeStamp(); document.querySelector('[data-page="fundraising-content"] .fundraising-poster-name').id = d.poster + "-name"; document.querySelector('[data-page="fundraising-content"] .fundraising-user-icon').id = d.poster + "-icon"; document.querySelector('[data-page="fundraising-content"] .navbar .title').innerText = d.title; document.querySelector('[data-page="fundraising-content"] .fundraising-content-top .title').innerText = d.title;
        document.querySelector('[data-page="fundraising-content"] .content').innerText = d.content; document.querySelector('[data-page="fundraising-content"] .fundraising-post-time').innerText = timedifference(d.time, e); document.querySelector("#donate-target").innerText = "\u76ee\u6a19\u91d1\u984d\uff1a$" + d.target; document.querySelector("#donate-now").innerText = "\u76ee\u524d\u7d2f\u7a4d\u91d1\u984d\uff1a$" + d.now; document.querySelector("#donate-count").innerText = "\u6350\u6b3e\u4eba\u6578\uff1a" + d.nowPeople + "\u4eba";
        document.querySelector("#fundraising-state .donate-now").innerText = d.now; document.querySelector("#fundraising-state .donate-target").innerText = d.target; var c = parseInt(d.now) / parseInt(d.target) * 100; document.querySelector("#fundraising-state .donate-bar-inner").style.width = c + "%"; document.querySelector("#fundraising-state .donate-link").href = "/select-payment/?index=" + a + "&name=" + d.title; document.querySelector("#fundraising-info .donate-link").href = "/select-payment/?index=" + a + "&name=" + d.title; if (void 0 !=
            d.updates) for (i in d.updates) c = (new DOMParser).parseFromString(fundraisingUpdateListItem, "text/html"), c.querySelector(".update-link").href = "/fundraising-update-content/?index=" + a + "&updateIndex=" + i, c.querySelector(".post-time").innerText = timedifference(d.updates[i].time, e), c.querySelector(".title").innerText = d.updates[i].title, c.querySelector(".content").innerHTML = d.updates[i].content, $("[data-page='fundraising-content'] #fundraising-update").append(c.querySelector(".update-link").outerHTML); GetMidWayInfo(d.poster,
                function (a) {
                    var b = document.querySelector(".page[data-page='fundraising-content'] #" + d.poster + "-icon"), c = document.querySelector(".page[data-page='fundraising-content'] #" + d.poster + "-name"); null != b && (b.src = a.icon); null != c && (c.innerText = a.principle_name); document.querySelector("#midway-name").innerText = "\u4e2d\u9014\u4e4b\u5bb6\u540d\u7a31\uff1a" + a.midway_name; document.querySelector("#principle-name").innerText = "\u8ca0\u8cac\u4eba\u59d3\u540d\uff1a" + a.principle_name; document.querySelector("#address").innerText =
                        "\u5730\u5740\uff1a" + a.address; document.querySelector("#telphone").innerText = "\u9023\u7d61\u96fb\u8a71\uff1a" + a.telephone; document.querySelector("#email").innerText = "\u96fb\u5b50\u90f5\u4ef6\uff1a" + a.email; document.querySelector("#visit-time").innerText = "\u53ef\u53c3\u89c0\u6642\u9593\uff1a" + a.visit_time
                })
    })
}
function LoadFundraisingUpdateContent(a, d) {
    GetFundraisingUpdate(a, d, function (a) {
        var d = getNowTimeStamp(); document.querySelector('[data-page="fundraising-update-content"] .poster-name').id = a.poster + "-name"; document.querySelector('[data-page="fundraising-update-content"] .user-icon').id = a.poster + "-icon"; document.querySelector('[data-page="fundraising-update-content"] .navbar .title').innerText = a.title; document.querySelector('[data-page="fundraising-update-content"] .article-title').innerText = a.title;
        document.querySelector('[data-page="fundraising-update-content"] .fundraising-update-content-text').innerHTML = a.content; document.querySelector('[data-page="fundraising-update-content"] .fundraising-update-post-time').innerText = timedifference(a.time, d); GetMidWayInfo(a.poster, function (d) {
            var b = document.querySelector(".page[data-page='fundraising-update-content'] #" + a.poster + "-icon"), c = document.querySelector(".page[data-page='fundraising-update-content'] #" + a.poster + "-name"); null != b && (b.src = d.icon);
            null != c && (c.innerText = d.principle_name)
        })
    })
}
function LoadDonatePaymentContent(a) {
    GetDonatePaymentContent(a, function (a) {
        $('[data-page="donate-payment-content"] .content-block').attr("style", "display:block;"); if ("CVS" == a.paymentMethod) {
            $(".atm_tr").css("display", "none"); document.querySelector('[data-page="donate-payment-content"] #itemName').innerText = a.itemName; document.querySelector('[data-page="donate-payment-content"] #tradeNo').innerText = a.tradeNo; document.querySelector('[data-page="donate-payment-content"] #expireDate').innerText = a.expireDate;
            document.querySelector('[data-page="donate-payment-content"] #totalAmount').innerText = a.totalAmount; document.querySelector('[data-page="donate-payment-content"] #paymentNoCVS').innerText = a.paymentNo; var d; "IBON" == a.CVS_Type ? d = "7-Eleven" : "FAMILY" == a.CVS_Type ? d = "\u5168\u5bb6" : "HILIFE" == a.CVS_Type ? d = "\u840a\u723e\u5bcc" : "OK" == a.CVS_Type && (d = "OK\u8d85\u5546"); document.querySelector('[data-page="donate-payment-content"] #CVS_Type').innerText = d; void 0 != a.qr ? document.querySelector('[data-page="donate-payment-content"] #qr').src =
                a.qr : document.querySelector('[data-page="donate-payment-content"] .qr-container').style.display = "none"
        } else $(".cvs_tr").css("display", "none"), document.querySelector('[data-page="donate-payment-content"] #itemName').innerText = a.itemName, document.querySelector('[data-page="donate-payment-content"] #tradeNo').innerText = a.tradeNo, document.querySelector('[data-page="donate-payment-content"] #expireDate').innerText = a.expireDate, document.querySelector('[data-page="donate-payment-content"] #totalAmount').innerText =
            a.totalAmount, document.querySelector('[data-page="donate-payment-content"] #paymentNoATM').innerText = a.paymentNo, document.querySelector('[data-page="donate-payment-content"] #bank').innerText = a.bank
    })
} var chatroomListItem = "";
function showChatroomList(a) {
    if (void 0 == a || null == a) isLoadingChatroom = !1; else if (0 >= a.length && console.log("\u6c92\u6709\u66f4\u591a\u6587\u7ae0"), console.log("show chatroom list"), getNowTimeStamp(), "" == chatroomListItem) $.get("pages/elements/chatroom-list-item.html", function (c) {
        chatroomListItem = c; c = ""; console.log("start initial list"); for (i in a) {
            var b = (new DOMParser).parseFromString(chatroomListItem, "text/html"); b.querySelector(".chatroom-list-name").id = i + "-name"; b.querySelector(".chatroom-list-user-icon").id =
                i + "-icon"; b.querySelector(".chatroom-link").href = "/chatroom-content/?index=" + i; c = b.querySelector(".chatroom-link").outerHTML + c
        } $(".chatroom-list").html(c); for (i in a) GetUserInfo(i, function (a, b) {
            console.log("load user icon"); console.log("uid: " + b); console.log("icon: " + a.icon); console.log("name: " + a.name); var c = document.querySelector(".page[data-page='chatroom'] #" + b + "-icon"), d = document.querySelector(".page[data-page='chatroom'] #" + b + "-name"); null != c && (c.src = a.icon, c.id = ""); null != d && (d.innerText = a.name,
                d.id = "")
        }); app.ptr.done($chatroomPtrContent); isLoadingChatroom = !1
    }); else {
        var d = ""; console.log("start initial list"); for (i in a) { var e = (new DOMParser).parseFromString(chatroomListItem, "text/html"); e.querySelector(".chatroom-list-name").id = i + "-name"; e.querySelector(".chatroom-list-user-icon").id = i + "-icon"; e.querySelector(".chatroom-link").href = "/chatroom-content/?index=" + i; d = e.querySelector(".chatroom-link").outerHTML + d } $(".chatroom-list").html(d); for (i in a) GetUserInfo(i, function (a, b) {
            var c = document.querySelector(".page[data-page='chatroom'] #" +
                b + "-icon"), d = document.querySelector(".page[data-page='chatroom'] #" + b + "-name"); userIconCache[b] = a.icon; userNameCache[b] = a.name; null != c && (c.src = a.icon, c.id = ""); null != d && (d.innerText = a.name, d.id = "")
        }); app.ptr.done($chatroomPtrContent); isLoadingChatroom = !1
    }
}
function LoadChatroomContent(a) {
    GetChatroomMessage(a, function (d) {
        getNowTimeStamp(); $.get("pages/elements/chatroom-message-item.html", function (e) {
            var c = ""; for (i in d) {
                var b = (new DOMParser).parseFromString(e, "text/html"), g = "left"; d[i].poster == userInfo.uid && (g = "right"); b.querySelector(".chatroom-message-item").className = "chatroom-message-item " + g; void 0 == userIconCache[d[i].poster] ? b.querySelector(".chatroom-user-icon").dataset.name = d[i].poster : b.querySelector(".chatroom-user-icon").src = userIconCache[d[i].poster];
                b.querySelector(".chatroom-message-content").innerText = d[i].content; c += b.querySelector(".chatroom-message-item").outerHTML
            } document.querySelector('[data-page="chatroom-content"] .message-area').innerHTML = c; $('[data-page="chatroom-content"] .page-content').scrollTop($('[data-page="chatroom-content"] .page-content')[0].scrollHeight); void 0 == userIconCache[a] && GetUserInfo(a, function (b) {
            userIconCache[a] = b.icon; document.querySelector('[data-page="chatroom-content"] .title').innerText = "\u8207" + b.name + "\u7684\u5c0d\u8a71";
                for (var c = document.querySelectorAll('img[data-name = "' + a + '"]'), d = 0; d < c.length; d++)c[d].src = b.icon
            }); void 0 == userIconCache[userInfo.uid] && GetUserInfo(userInfo.uid, function (a) { userIconCache[userInfo.uid] = a.icon; for (var b = document.querySelectorAll('img[data-name = "' + userInfo.uid + '"]'), c = 0; c < b.length; c++)b[c].src = a.icon }); void 0 == userNameCache[a] ? GetUserInfo(a, function (a) { document.querySelector('[data-page="chatroom-content"] .title').innerText = "\u8207" + a.name + "\u7684\u5c0d\u8a71" }) : document.querySelector('[data-page="chatroom-content"] .title').innerText =
                "\u8207" + userNameCache[a] + "\u7684\u5c0d\u8a71"
        })
    }); document.querySelector('[data-page="chatroom-content"] .send-button').setAttribute("onclick", "SendChatroomMessage('" + a + "')")
}
function LoadTutorialContent(a) { a = tutorialArticle[a]; document.querySelector('[data-page="noob-tutorial-content"] .title').innerText = a.title; document.querySelector('[data-page="noob-tutorial-content"] .article-title').innerText = a.title; document.querySelector('[data-page="noob-tutorial-content"] .article-main').innerHTML = a.content } var nowHospitalIndex = 0, isLoadingHospital = !1;
function LoadHospitalPage(a, d, e, c) { isLoadingHospital ? app.ptr.done($hospitalPtrContent) : (isLoadingHospital = !0, c && (nowHospitalIndex = 0), c ? e ? GetNightHospitalList(a, d, function (a) { ShowHospitalList(a, c) }) : GetHospitalList(a, d, function (a) { ShowHospitalList(a, c) }) : (a = hospitalCache.slice(d, d + 20), ShowHospitalList(a, c))) } var hospitalListItem = "", positionCache = {};
function ShowHospitalList(a, d) {
    function e(a, c) { return calcCrow(positionCache.lat, positionCache.lng, a.lat, a.lng) < calcCrow(positionCache.lat, positionCache.lng, c.lat, c.lng) ? -1 : calcCrow(positionCache.lat, positionCache.lng, a.lat, a.lng) > calcCrow(positionCache.lat, positionCache.lng, c.lat, c.lng) ? 1 : 0 } d && (document.querySelector("[data-page='noob'] #tab-hospital .infinite-scroll-preloader").style.display = "block", document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML = ""); 20 > a.length && (document.querySelector("[data-page='noob'] #tab-hospital .infinite-scroll-preloader").style.display =
        "none"); var c = ""; if (void 0 == positionCache.lat) navigator.geolocation.getCurrentPosition(function (b) {
        positionCache.lat = b.coords.latitude; positionCache.lng = b.coords.longitude; a.sort(e); for (b = 0; b < a.length; b++) {
            var f = (new DOMParser).parseFromString(hospitalListItem, "text/html"); f.querySelector(".hospital-name").innerText = a[b]["\u6a5f\u69cb\u540d\u7a31"]; f.querySelector(".hospital-distance").innerText = "\u8ddd\u96e2 " + calcCrow(positionCache.lat, positionCache.lng, a[b].lat, a[b].lng).toFixed(1) + "\u516c\u91cc";
            f.querySelector(".hospital-address").innerText = "\u5730\u5740\uff1a" + a[b]["\u6a5f\u69cb\u5730\u5740"]; f.querySelector(".hospital-phone-link").setAttribute("onclick", 'OpenLink("tel:' + a[b]["\u6a5f\u69cb\u96fb\u8a71"] + '")'); f.querySelector(".hospital-locate-link").setAttribute("onclick", 'OpenLink("geo:' + a[b].lat + "," + a[b].lng + "?q=" + a[b].lat + "," + a[b].lng + "(" + a[b]["\u6a5f\u69cb\u540d\u7a31"] + ')")'); c += f.querySelector(".hospital-list-item").outerHTML
        } d ? document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML =
            c : document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML = document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML + c; nowHospitalIndex += a.length; isLoadingHospital = !1
        }, function (a) { console.log(a) }, { enableHighAccuracy: !0 }); else {
            a.sort(e); for (var b = 0; b < a.length; b++) {
                var g = (new DOMParser).parseFromString(hospitalListItem, "text/html"); g.querySelector(".hospital-name").innerText = a[b]["\u6a5f\u69cb\u540d\u7a31"]; g.querySelector(".hospital-distance").innerText = "\u8ddd\u96e2 " +
                    calcCrow(positionCache.lat, positionCache.lng, a[b].lat, a[b].lng).toFixed(1) + "\u516c\u91cc"; g.querySelector(".hospital-address").innerText = "\u5730\u5740\uff1a" + a[b]["\u6a5f\u69cb\u5730\u5740"]; g.querySelector(".hospital-phone-link").setAttribute("onclick", 'OpenLink("tel:' + a[b]["\u6a5f\u69cb\u96fb\u8a71"] + '")'); g.querySelector(".hospital-locate-link").setAttribute("onclick", 'OpenLink("geo:' + a[b].lat + "," + a[b].lng + "?q=" + a[b].lat + "," + a[b].lng + "(" + a[b]["\u6a5f\u69cb\u540d\u7a31"] + ')")'); c += g.querySelector(".hospital-list-item").outerHTML
            } d ?
                document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML = c : document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML = document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML + c; nowHospitalIndex += a.length; isLoadingHospital = !1
    } app.ptr.done($hospitalPtrContent)
} var taiwanDistrictJson;
function initialHospitalFilter() { $.get("./TaiwanDistrict.json", function (a) { taiwanDistrictJson = a; a = "<option>\u5168\u90e8\u7e23\u5e02</option>"; for (var d = 0; d < taiwanDistrictJson.length; d++)a += "<option>" + taiwanDistrictJson[d].city + "</option>"; document.querySelector("select#city").innerHTML = a; OnCiyFilterChanged() }, "json") }
function OnCiyFilterChanged() {
    var a = document.querySelector("select#city").value; if ("\u5168\u90e8\u7e23\u5e02" == a) document.querySelector(".district-container").innerHTML = ""; else {
        var d = $.grep(taiwanDistrictJson, function (c) { return c.city == a })[0]; document.querySelector(".district-container").innerHTML = ""; for (var e = 0; e < d.area.length; e++)document.querySelector(".district-container").innerHTML += '<p> <input type="checkbox" name="district" id="' + d.area[e]["#text"] + '" data-name="' + d.area[e]["#text"] + '"/> <label for="' +
            d.area[e]["#text"] + '">' + d.area[e]["#text"] + "</label> </p>"
    }
}
function ApplyHospitalFilter() {
    var a = document.querySelector("select#city").value, d = document.getElementsByName("district"), e = ""; "\u5168\u90e8\u7e23\u5e02" != a && (e = "?\u7e23\u5e02_like=" + a); for (a = 0; a < d.length; a++)d[a].checked && (e += "&\u6a5f\u69cb\u5730\u5740_like=" + d[a].id); d = document.querySelector(".night-filter #isNight").checked; document.querySelector("[data-page='noob'] #tab-hospital .infinite-scroll-preloader").style.display = "block"; document.querySelector('[data-page = "noob"] .noob-hospital-list').innerHTML = "";
    LoadHospitalPage(e, 0, d, !0)
} function UpdateUserProfile() { document.querySelector('[data-page="user-info"] #user-icon').src = userInfo.icon; document.querySelector('[data-page="user-info"] #user-email').innerText = "Email\uff1a" + userInfo.email; document.querySelector('[data-page="user-info"] #user-name').innerText = "\u6703\u54e1\u540d\u7a31\uff1a" + userInfo.name } function OpenLink(a) { window.open(a, "_system") }
function calcCrow(a, d, e, c) { var b = toRad(e - a); d = toRad(c - d); a = toRad(a); e = toRad(e); a = Math.sin(b / 2) * Math.sin(b / 2) + Math.sin(d / 2) * Math.sin(d / 2) * Math.cos(a) * Math.cos(e); return 12742 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)) } function toRad(a) { return a * Math.PI / 180 } $.get("pages/elements/forum-article-item.html", function (a) { forumArticleItemStr = a }); var fundraisingUpdateListItem = ""; $.get("pages/elements/fundraising-update-list-item.html", function (a) { fundraisingUpdateListItem = a }); var tutorialListItem = "";
$.get("pages/elements/noob-tutorial-list-item.html", function (a) { tutorialListItem = a }); hospitalListItem = ""; $.get("pages/elements/hospital-list-item.html", function (a) { hospitalListItem = a }); var donateRecordListItem = ""; $.get("pages/elements/donate-record-list-item.html", function (a) { donateRecordListItem = a }); function GetForumClassifyName(a) { return 0 == a ? "\u60c5\u5831" : 1 == a ? "\u63d0\u554f" : 2 == a ? "\u9001\u990a" : "\u5931\u8e64" } function getNowTimeStamp() { return (new Date).getTime() }
function timedifference(a, d) { var e = Math.abs(a - d), c = Math.floor(e / 864E5), b = e % 864E5; e = Math.floor(b / 36E5); var g = b % 36E5; b = Math.floor(g / 6E4); g = Math.round(g % 6E4 / 1E3); return 0 < c ? c + "\u5929\u524d" : 0 < e ? e + "\u5c0f\u6642\u524d" : 0 < b ? b + "\u5206\u9418\u524d" : g + "\u79d2\u524d" } function removePage(a) { pageHistory.pop(); $$('.page[data-page = "' + a + '"]').remove() } updatePosition(); var nowPositionDistrict;
function updatePosition() {
    navigator.geolocation.getCurrentPosition(function (a) {
    positionCache.lat = a.coords.latitude; positionCache.lng = a.coords.longitude; $.get("https://api.opencagedata.com/geocode/v1/json?q=" + a.coords.latitude + "+" + a.coords.longitude + "&key=fec7294f81724e4eb96707e395b4ef03", function (a) {
        var d = ""; void 0 != a.results[0].components.state_district ? d = a.results[0].components.state_district : void 0 != a.results[0].components.suburb ? d = a.results[0].components.suburb : void 0 != a.results[0].components.town ?
            d = a.results[0].components.town : void 0 != a.results[0].components.hamlet ? d = a.results[0].components.hamlet : void 0 != a.results[0].components.city && (d = a.results[0].components.city); console.log("now position = " + d); void 0 != FCMPlugin && "" != d && (void 0 == nowPositionDistrict ? (nowPositionDistrict = d, FCMPlugin.subscribeToTopic(nowPositionDistrict), console.log("subscribe for " + nowPositionDistrict)) : nowPositionDistrict != d && (FCMPlugin.unsubscribeFromTopic(nowPositionDistrict), nowPositionDistrict = d, FCMPlugin.subscribeToTopic(nowPositionDistrict),
                console.log("subscribe for " + nowPositionDistrict)))
    })
    }, function (a) { console.log(a) }, { enableHighAccuracy: !0 })
} setInterval("updatePosition()", 1E4); function OpenMidWayApplication() { window.open("https://docs.google.com/forms/d/e/1FAIpQLSd2rOIGhgNrQRa_QFv-mrudGuSKC0n65MNPREE677Mj0Pa2_w/viewform?fbclid=IwAR1g9vDJFgTu6n5i-8w710upCEScrgjAobxZeIq653yj59yths-qCrGdmQA", "_system") }
var mainView = app.views.create(".view-main", { stackPages: !0 }), forumView = app.views.create("#forum-tab", { stackPages: !0 }), helpView = app.views.create("#help-tab", { stackPages: !0 }), fundraisingView = app.views.create("#fundraising-tab", { stackPages: !0 }), chatroomView = app.views.create("#chatroom-tab", { stackPages: !0 }), noobView = app.views.create("#noob-tab", { stackPages: !0 }), myPostView = app.views.create("#my-post-tab", { stackPages: !0 }), userInfoView = app.views.create("#user-info-tab", { stackPages: !0 }); app.init();